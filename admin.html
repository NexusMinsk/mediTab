<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель - Meditab</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== СТИЛИ САЙТА MEDITAB ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --white: #ffffff;
            --bg-dark: #182231;
            --accent-blue: #cddce4;
            --text-gray: #586474;
            --border-gray: #d9d9d9;
            --accent-orange: #cf7911;
            --accent-orange-light: #ff9d3d;
            --shadow: 0 4px 20px rgba(24, 34, 49, 0.1);
            --shadow-hover: 0 8px 30px rgba(24, 34, 49, 0.15);
            --shadow-dark: 0 12px 40px rgba(24, 34, 49, 0.2);
            --radius: 16px;
            --radius-sm: 8px;
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --gradient-orange: linear-gradient(135deg, var(--accent-orange), var(--accent-orange-light));
            --gradient-blue: linear-gradient(135deg, var(--accent-blue), #e8f0f5);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            color: var(--text-gray);
            background: #f8fafc;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== ЭКРАН ВХОДА ===== */
        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #182231 0%, #2c3e50 100%);
            padding: 20px;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow-dark);
            text-align: center;
        }

        .login-box h1 {
            color: var(--bg-dark);
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .login-box p {
            color: var(--text-gray);
            margin-bottom: 30px;
        }

        .login-input {
            width: 100%;
            padding: 14px 20px;
            margin-bottom: 20px;
            border: 2px solid var(--border-gray);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
        }

        .login-input:focus {
            outline: none;
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 3px rgba(207, 121, 17, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: var(--gradient-orange);
            color: var(--white);
            border: none;
            border-radius: var(--radius);
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(207, 121, 17, 0.3);
        }

        .error-message {
            color: #ef4444;
            margin-top: 15px;
            display: none;
        }

        /* ===== ШАПКА АДМИНКИ ===== */
        .admin-header {
            background: var(--bg-dark);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .admin-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-logo i {
            color: var(--accent-orange);
        }

        .admin-nav a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .admin-nav a:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .logout-btn {
            background: var(--accent-orange);
            color: white !important;
        }

        /* ===== КОНТЕНТ АДМИНКИ ===== */
        .admin-content {
            display: none;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ===== САЙДБАР ===== */
        .admin-sidebar {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
        }

        .admin-stats {
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--gradient-blue);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 15px;
        }

        .stat-card h3 {
            color: var(--bg-dark);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--accent-orange);
        }

        /* ===== ФОРМА ДОБАВЛЕНИЯ ТОВАРА ===== */
        .admin-main {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--bg-dark);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent-orange);
        }

        .form-section {
            background: rgba(205, 220, 228, 0.1);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-gray);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--bg-dark);
            font-size: 0.95rem;
        }

        .form-label i {
            color: var(--accent-orange);
            margin-right: 5px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-gray);
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 1rem;
            color: var(--bg-dark);
            transition: var(--transition);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 3px rgba(207, 121, 17, 0.1);
        }

        /* ===== СПИСКИ (характеристики, преимущества) ===== */
        .list-container {
            background: white;
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 1px solid var(--border-gray);
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .list-item {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(205, 220, 228, 0.1);
            border-radius: var(--radius-sm);
            align-items: center;
        }

        .feature-item {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            background: var(--accent-orange);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .btn-small:hover {
            background: var(--accent-orange-light);
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: var(--accent-blue);
            color: var(--bg-dark);
        }

        .btn-secondary:hover {
            background: #b8c9d4;
        }

        /* ===== СПИСОК ТОВАРОВ ===== */
        .products-list {
            margin-top: 40px;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .products-table th {
            background: var(--gradient-blue);
            color: var(--bg-dark);
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .products-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-gray);
        }

        .products-table tr:hover {
            background: rgba(205, 220, 228, 0.1);
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        /* ===== КНОПКИ УПРАВЛЕНИЯ ===== */
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid var(--border-gray);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: var(--radius);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--gradient-orange);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(207, 121, 17, 0.3);
        }

        .btn-outline {
            background: white;
            color: var(--accent-orange);
            border: 2px solid var(--accent-orange);
        }

        .btn-outline:hover {
            background: var(--accent-orange);
            color: white;
        }

        /* ===== СООБЩЕНИЯ ===== */
        .message {
            padding: 15px 20px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            display: none;
        }

        .message-success {
            background: #10b981;
            color: white;
            display: block;
        }

        .message-error {
            background: #ef4444;
            color: white;
            display: block;
        }

        /* ===== АДАПТИВНОСТЬ ===== */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .admin-header .container {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .admin-nav {
                display: flex;
                gap: 10px;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* ===== НОВЫЕ СТИЛИ ДЛЯ ВКЛАДОК И КАТЕГОРИЙ ===== */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border-gray);
            padding-bottom: 5px;
        }

        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-weight: 600;
            color: var(--text-gray);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .tab-btn:hover {
            color: var(--accent-orange);
            background: rgba(207, 121, 17, 0.1);
        }

        .tab-btn.active {
            color: var(--accent-orange);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -7px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-orange);
            border-radius: 2px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Стили для списка категорий */
        .categories-list {
            margin-top: 20px;
        }

        .category-item {
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: rgba(205, 220, 228, 0.1);
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            border: 1px solid var(--border-gray);
            transition: var(--transition);
        }

        .category-item:hover {
            background: rgba(205, 220, 228, 0.2);
            border-color: var(--accent-orange);
        }

        .category-icon-preview {
            width: 40px;
            height: 40px;
            background: var(--gradient-blue);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--accent-orange);
        }

        .category-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .category-name {
            font-weight: 600;
            color: var(--bg-dark);
        }

        .category-id {
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        /* Кнопки управления категориями */
        .category-controls {
            display: flex;
            gap: 10px;
        }

        .btn-edit {
            background: var(--accent-blue);
            color: var(--bg-dark);
        }

        .btn-edit:hover {
            background: #b8c9d4;
        }

        .btn-delete-cat {
            background: #ef4444;
            color: white;
        }

        .btn-delete-cat:hover {
            background: #dc2626;
        }

        /* Форма категории */
        .icon-selector {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .icon-option {
            width: 50px;
            height: 50px;
            background: var(--gradient-blue);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--bg-dark);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .icon-option:hover {
            transform: scale(1.1);
            background: var(--gradient-orange);
            color: white;
        }

        .icon-option.selected {
            border-color: var(--accent-orange);
            background: var(--gradient-orange);
            color: white;
        }

        /* Сообщение о пустых категориях */
        .empty-categories {
            text-align: center;
            padding: 40px;
            color: var(--text-gray);
        }

        .empty-categories i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <!-- ===== ЭКРАН ВХОДА ===== -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h1><i class="fas fa-lock"></i> Админ-панель</h1>
            <p>Meditab - Медицинское оборудование</p>
            
            <input type="password" id="passwordInput" class="login-input" placeholder="Введите пароль" autocomplete="off">
            
            <button onclick="checkPassword()" class="login-btn">
                <i class="fas fa-sign-in-alt"></i> Войти
            </button>
            
            <div id="loginError" class="error-message">
                <i class="fas fa-exclamation-triangle"></i> Неверный пароль
            </div>
            
            <div style="margin-top: 20px; font-size: 0.9rem; color: var(--text-gray);">
                <p><strong>Пароль по умолчанию:</strong> admin123</p>
                <p style="margin-top: 10px;">Изменить пароль можно в коде (строка 650)</p>
            </div>
        </div>
    </div>

    <!-- ===== АДМИН-ПАНЕЛЬ (скрыта до входа) ===== -->
    <div id="adminPanel" class="admin-content">
        <!-- Шапка -->
        <header class="admin-header">
            <div class="container">
                <a href="catalog.html" class="admin-logo">
                    <i class="fas fa-shield-alt"></i> Meditab Admin
                </a>
                <nav class="admin-nav">
                    <a href="catalog.html"><i class="fas fa-store"></i> На сайт</a>
                    <a href="index.html"><i class="fas fa-home"></i> Главная</a>
                    <a href="#" onclick="logout()" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Выйти
                    </a>
                </nav>
            </div>
        </header>

        <!-- Основной контент -->
        <div class="container">
            <div class="admin-grid">
                <!-- Сайдбар -->
                <aside class="admin-sidebar">
                    <div class="admin-stats">
                        <div class="stat-card">
                            <h3>Всего товаров</h3>
                            <div class="number" id="totalProducts">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Категории</h3>
                            <div class="number" id="totalCategories">8</div>
                        </div>
                        <div class="stat-card">
                            <h3>Последнее обновление</h3>
                            <div style="font-size: 1rem;" id="lastUpdate">Сегодня</div>
                        </div>
                    </div>

                    <div>
                        <h3 style="color: var(--bg-dark); margin-bottom: 15px;">Быстрые действия</h3>
                        <button class="btn btn-secondary" onclick="clearForm()" style="width: 100%; margin-bottom: 10px;">
                            <i class="fas fa-broom"></i> Очистить форму
                        </button>
                        <button class="btn btn-secondary" onclick="switchTab('categories')" style="width: 100%; margin-bottom: 10px;">
                            <i class="fas fa-folder"></i> Управление категориями
                        </button>
                        <button class="btn btn-secondary" onclick="importDemoProducts()" style="width: 100%; margin-bottom: 10px;">
                            <i class="fas fa-download"></i> Добавить демо-товары
                        </button>
                        <button class="btn btn-secondary" onclick="exportProducts()" style="width: 100%;">
                            <i class="fas fa-file-export"></i> Экспорт в JSON
                        </button>
                    </div>
                </aside>

                <!-- Основная форма -->
                <main class="admin-main">
                    <!-- Сообщения -->
                    <div id="messageBox" class="message"></div>

                    <!-- Вкладки -->
                    <div class="admin-tabs">
                        <button class="tab-btn active" onclick="switchTab('products')">
                            <i class="fas fa-box"></i> Товары
                        </button>
                        <button class="tab-btn" onclick="switchTab('categories')">
                            <i class="fas fa-folder"></i> Категории
                        </button>
                        <button class="tab-btn" onclick="switchTab('import')">
                            <i class="fas fa-upload"></i> Импорт
                        </button>
                    </div>

                    <!-- Вкладка Товары -->
                    <div id="productsTab" class="tab-content active">
                        <!-- Форма товара -->
                        <h2 class="section-title" id="formTitle">
                            <i class="fas fa-plus"></i> Добавить новый товар
                        </h2>

                        <form id="productForm">
                            <!-- Раздел 1: Основная информация -->
                            <div class="form-section">
                                <h3 style="color: var(--bg-dark); margin-bottom: 20px;">
                                    <i class="fas fa-info-circle"></i> Основная информация
                                </h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="productCategory">
                                            <i class="fas fa-folder"></i> Категория товара *
                                        </label>
                                        <select id="productCategory" class="form-select" required>
                                            <option value="">-- Выберите категорию --</option>
                                            <!-- Категории будут загружены динамически -->
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label" for="cardTitle">
                                            <i class="fas fa-heading"></i> Название товара *
                                        </label>
                                        <input type="text" id="cardTitle" class="form-input" 
                                               placeholder="Например: Тонометр автоматический DS-500" required>
                                    </div>
                                </div>

                                <!-- Цена -->
                                <div class="form-group">
                                    <label class="form-label" for="price">
                                        <i class="fas fa-tag"></i> Цена товара *
                                    </label>
                                    <input type="text" id="price" class="form-input" 
                                           placeholder="Например: 199 BYN" 
                                           value="199 BYN" required>
                                    <small style="color: var(--text-gray); margin-top: 5px; display: block;">
                                        Введите цену в формате "199 BYN"
                                    </small>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="cardImage">
                                            <i class="fas fa-image"></i> Ссылка на фото *
                                        </label>
                                        <input type="text" id="cardImage" class="form-input" 
                                               placeholder="https://example.com/photo.jpg"
                                               value="https://placehold.co/400x300/e2e8f0/475569?text=Фото+товара">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label" for="cardDesc">
                                            <i class="fas fa-align-left"></i> Краткое описание *
                                        </label>
                                        <textarea id="cardDesc" class="form-textarea" 
                                                  placeholder="Краткое описание для карточки товара..." 
                                                  required></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Раздел 2: Детальная информация -->
                            <div class="form-section">
                                <h3 style="color: var(--bg-dark); margin-bottom: 20px;">
                                    <i class="fas fa-file-alt"></i> Детальная информация
                                </h3>
                                
                                <div class="form-group">
                                    <label class="form-label" for="pageTitle">
                                        <i class="fas fa-heading"></i> Полное название
                                    </label>
                                    <input type="text" id="pageTitle" class="form-input" 
                                           placeholder="Полное официальное название товара...">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="pageDesc">
                                        <i class="fas fa-align-left"></i> Полное описание
                                    </label>
                                    <textarea id="pageDesc" class="form-textarea" 
                                              placeholder="Подробное описание товара..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="pageGallery">
                                        <i class="fas fa-images"></i> Галерея фото (каждая ссылка с новой строки)
                                    </label>
                                    <textarea id="pageGallery" class="form-textarea" 
                                              placeholder="https://example.com/photo1.jpg
https://example.com/photo2.jpg"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="pageVideo">
                                        <i class="fas fa-video"></i> Ссылка на видео (YouTube)
                                    </label>
                                    <input type="text" id="pageVideo" class="form-input" 
                                           placeholder="https://youtube.com/watch?v=...">
                                </div>
                            </div>

                            <!-- Раздел 3: Характеристики -->
                            <div class="form-section">
                                <h3 style="color: var(--bg-dark); margin-bottom: 20px;">
                                    <i class="fas fa-list"></i> Характеристики
                                </h3>
                                
                                <div class="list-container" id="specsContainer">
                                    <div class="list-item">
                                        <input type="text" class="spec-name form-input" placeholder="Название характеристики">
                                        <input type="text" class="spec-value form-input" placeholder="Значение">
                                        <button type="button" class="btn-small btn-danger" onclick="removeSpec(this)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <button type="button" class="btn btn-secondary" onclick="addSpecField()">
                                    <i class="fas fa-plus"></i> Добавить характеристику
                                </button>
                            </div>

                            <!-- Раздел 4: Преимущества -->
                            <div class="form-section">
                                <h3 style="color: var(--bg-dark); margin-bottom: 20px;">
                                    <i class="fas fa-star"></i> Преимущества
                                </h3>
                                
                                <div class="list-container" id="featuresContainer">
                                    <div class="feature-item">
                                        <input type="text" class="feature-input form-input" placeholder="Например: Большой дисплей">
                                        <button type="button" class="btn-small btn-danger" onclick="removeFeature(this)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <button type="button" class="btn btn-secondary" onclick="addFeatureField()">
                                    <i class="fas fa-plus"></i> Добавить преимущество
                                </button>
                            </div>

                            <!-- Кнопки управления -->
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="clearForm()">
                                    <i class="fas fa-times"></i> Очистить
                                </button>
                                <button type="button" class="btn btn-outline" onclick="saveDraft()">
                                    <i class="fas fa-save"></i> Черновик
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-rocket"></i> Опубликовать товар
                                </button>
                            </div>
                        </form>

                        <!-- Список существующих товаров -->
                        <div class="products-list">
                            <h3 class="section-title">
                                <i class="fas fa-boxes"></i> Существующие товары
                            </h3>
                            
                            <div id="productsTable">
                                <!-- Сюда загрузится таблица товаров -->
                                <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                                    <i class="fas fa-box-open fa-2x" style="margin-bottom: 15px; opacity: 0.5;"></i>
                                    <p>Товаров пока нет</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Вкладка Категории -->
                    <div id="categoriesTab" class="tab-content">
                        <h2 class="section-title">
                            <i class="fas fa-folder"></i> Управление категориями
                        </h2>

                        <!-- Форма добавления/редактирования категории -->
                        <div class="form-section">
                            <h3 style="color: var(--bg-dark); margin-bottom: 20px;">
                                <i class="fas fa-folder-plus"></i> <span id="categoryFormTitle">Добавить новую категорию</span>
                            </h3>
                            
                            <form id="categoryForm">
                                <input type="hidden" id="categoryId">
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="categoryName">
                                            <i class="fas fa-heading"></i> Название категории *
                                        </label>
                                        <input type="text" id="categoryName" class="form-input" 
                                               placeholder="Например: Тонометры" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label" for="categorySlug">
                                            <i class="fas fa-link"></i> ID категории (латиница) *
                                        </label>
                                        <input type="text" id="categorySlug" class="form-input" 
                                               placeholder="Например: tonometers" required>
                                        <small style="color: var(--text-gray); margin-top: 5px; display: block;">
                                            Используется в URL и коде (только латинские буквы и дефисы)
                                        </small>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-icons"></i> Иконка категории *
                                    </label>
                                    <div class="icon-selector" id="iconSelector">
                                        <!-- Иконки будут добавлены через JS -->
                                    </div>
                                    <input type="hidden" id="selectedIcon" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="categoryDescription">
                                        <i class="fas fa-align-left"></i> Описание категории
                                    </label>
                                    <textarea id="categoryDescription" class="form-textarea" 
                                              placeholder="Краткое описание категории..."></textarea>
                                </div>

                                <div class="form-actions">
                                    <button type="button" class="btn btn-outline" onclick="clearCategoryForm()">
                                        <i class="fas fa-times"></i> Отмена
                                    </button>
                                    <button type="submit" class="btn btn-primary" id="categorySubmitBtn">
                                        <i class="fas fa-plus"></i> Добавить категорию
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Список существующих категорий -->
                        <div class="categories-list">
                            <h3 style="color: var(--bg-dark); margin-bottom: 20px;">
                                <i class="fas fa-list"></i> Существующие категории
                            </h3>
                            
                            <div id="categoriesContainer">
                                <!-- Сюда загрузится список категорий -->
                                <div class="empty-categories">
                                    <i class="fas fa-folder-open"></i>
                                    <p>Категорий пока нет. Добавьте первую категорию.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Вкладка Импорт -->
                    <div id="importTab" class="tab-content">
                        <h2 class="section-title">
                            <i class="fas fa-upload"></i> Импорт товаров
                        </h2>

                        <div class="form-section">
                            <h3 style="color: var(--bg-dark); margin-bottom: 20px;">
                                <i class="fas fa-file-import"></i> Импорт из JSON
                            </h3>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-file-code"></i> JSON данные товаров
                                </label>
                                <textarea id="importJson" class="form-textarea" 
                                          placeholder='[{"id": 1, "category": "tonometers", "card": {"title": "Тонометр", "price": "199 BYN"...}}]'
                                          style="min-height: 300px; font-family: monospace;"></textarea>
                                <small style="color: var(--text-gray); margin-top: 5px; display: block;">
                                    Вставьте JSON массив товаров. Внимание: существующие товары будут заменены!
                                </small>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="clearImportForm()">
                                    <i class="fas fa-times"></i> Очистить
                                </button>
                                <button type="button" class="btn btn-primary" onclick="importProductsFromJson()">
                                    <i class="fas fa-file-import"></i> Импортировать товары
                                </button>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 style="color: var(--bg-dark); margin-bottom: 20px;">
                                <i class="fas fa-file-export"></i> Экспорт текущих товаров
                            </h3>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-code"></i> Текущие данные в JSON
                                </label>
                                <textarea id="exportJson" class="form-textarea" 
                                          style="min-height: 200px; font-family: monospace;" readonly></textarea>
                            </div>

                            <button type="button" class="btn btn-secondary" onclick="copyExportJson()">
                                <i class="fas fa-copy"></i> Скопировать JSON
                            </button>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <script>
        // ===== НАСТРОЙКИ =====
        const ADMIN_PASSWORD = "admin123";
        let editingProductId = null;
        let editingCategoryId = null;
        let currentProducts = [];
        let currentCategories = [];

        // ===== СИСТЕМА ВХОДА =====
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            const errorEl = document.getElementById('loginError');
            
            if (password === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadCategories();
                loadProducts();
                updateStats();
                showMessage('Добро пожаловать в админ-панель!', 'success');
            } else {
                errorEl.style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                errorEl.style.transform = 'translateX(10px)';
                setTimeout(() => errorEl.style.transform = 'translateX(0)', 300);
            }
        }

        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            location.reload();
        }

        // Проверяем авторизацию при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            if (sessionStorage.getItem('adminLoggedIn') === 'true') {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadCategories();
                loadProducts();
                updateStats();
            } else {
                document.getElementById('passwordInput').focus();
            }
            
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') checkPassword();
            });

            // Инициализация иконок
            initIconSelector();
        });

        // ===== УПРАВЛЕНИЕ ВКЛАДКАМИ =====
        function switchTab(tabName) {
            // Скрываем все вкладки
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Убираем активный класс со всех кнопок
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Показываем нужную вкладку
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Активируем кнопку
            document.querySelector(`.tab-btn[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            // Особые действия для вкладок
            if (tabName === 'import') {
                updateExportJson();
            }
        }

        // ===== УПРАВЛЕНИЕ ХАРАКТЕРИСТИКАМИ И ПРЕИМУЩЕСТВАМИ =====
        function addSpecField() {
            const container = document.getElementById('specsContainer');
            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerHTML = `
                <input type="text" class="spec-name form-input" placeholder="Название характеристики">
                <input type="text" class="spec-value form-input" placeholder="Значение">
                <button type="button" class="btn-small btn-danger" onclick="removeSpec(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(div);
        }

        function removeSpec(button) {
            const container = document.getElementById('specsContainer');
            const items = container.querySelectorAll('.list-item');
            if (items.length > 1) {
                button.closest('.list-item').remove();
            } else {
                const item = button.closest('.list-item');
                item.querySelector('.spec-name').value = '';
                item.querySelector('.spec-value').value = '';
            }
        }

        function addFeatureField() {
            const container = document.getElementById('featuresContainer');
            const div = document.createElement('div');
            div.className = 'feature-item';
            div.innerHTML = `
                <input type="text" class="feature-input form-input" placeholder="Например: Гарантия 3 года">
                <button type="button" class="btn-small btn-danger" onclick="removeFeature(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(div);
        }

        function removeFeature(button) {
            const container = document.getElementById('featuresContainer');
            const items = container.querySelectorAll('.feature-item');
            if (items.length > 1) {
                button.closest('.feature-item').remove();
            } else {
                const item = button.closest('.feature-item');
                item.querySelector('.feature-input').value = '';
            }
        }

        // ===== УПРАВЛЕНИЕ КАТЕГОРИЯМИ =====
        function initIconSelector() {
            const icons = [
                'fa-user-md', 'fa-heartbeat', 'fa-syringe', 'fa-bone', 'fa-female',
                'fa-socks', 'fa-eye', 'fa-vial', 'fa-stethoscope', 'fa-thermometer',
                'fa-band-aid', 'fa-crutch', 'fa-procedures', 'fa-hospital', 'fa-pills',
                'fa-prescription-bottle', 'fa-clinic-medical', 'fa-ambulance', 'fa-head-side-mask',
                'fa-hand-holding-medical', 'fa-shield-virus', 'fa-virus', 'fa-lungs', 'fa-brain'
            ];
            
            const container = document.getElementById('iconSelector');
            container.innerHTML = '';
            
            icons.forEach(icon => {
                const div = document.createElement('div');
                div.className = 'icon-option';
                div.innerHTML = `<i class="fas ${icon}"></i>`;
                div.onclick = () => selectIcon(icon);
                container.appendChild(div);
            });
            
            // Выбираем первую иконку по умолчанию
            if (icons.length > 0) {
                selectIcon(icons[0]);
            }
        }

        function selectIcon(iconName) {
            // Убираем выделение со всех иконок
            document.querySelectorAll('.icon-option').forEach(icon => {
                icon.classList.remove('selected');
            });
            
            // Выделяем выбранную иконку
            document.querySelectorAll('.icon-option').forEach(icon => {
                if (icon.querySelector('i').classList.contains(iconName)) {
                    icon.classList.add('selected');
                }
            });
            
            // Сохраняем выбранную иконку
            document.getElementById('selectedIcon').value = iconName;
        }

        function loadCategories() {
            try {
                // Пытаемся загрузить из LocalStorage
                currentCategories = JSON.parse(localStorage.getItem('categories')) || [];
                
                // Если категорий нет, создаем стандартные
                if (currentCategories.length === 0) {
                    createDefaultCategories();
                }
                
                renderCategoriesList();
                updateCategorySelect();
            } catch (error) {
                console.error('Ошибка загрузки категорий:', error);
                createDefaultCategories();
            }
        }

        function createDefaultCategories() {
            currentCategories = [
                {
                    id: 'clothing',
                    name: 'Медицинская одежда',
                    icon: 'fa-user-md',
                    description: 'Халаты, брюки, костюмы и другая медицинская одежда'
                },
                {
                    id: 'tonometers',
                    name: 'Тонометры',
                    icon: 'fa-heartbeat',
                    description: 'Автоматические, механические и запястные тонометры'
                },
                {
                    id: 'diabetes',
                    name: 'Диабетические товары',
                    icon: 'fa-syringe',
                    description: 'Глюкометры, тест-полоски, шприц-ручки'
                },
                {
                    id: 'orthopedic',
                    name: 'Ортопедические изделия',
                    icon: 'fa-bone',
                    description: 'Корсеты, бандажи, стельки, ортезы'
                },
                {
                    id: 'gynecology',
                    name: 'Гинекологические товары',
                    icon: 'fa-female',
                    description: 'Гинекологические инструменты и наборы'
                },
                {
                    id: 'compression',
                    name: 'Компрессионный трикотаж',
                    icon: 'fa-socks',
                    description: 'Чулки, гольфы, колготки компрессионные'
                },
                {
                    id: 'optics',
                    name: 'Оптика',
                    icon: 'fa-eye',
                    description: 'Офтальмоскопы, отоскопы, лупы'
                },
                {
                    id: 'tests',
                    name: 'Экспресс-тесты',
                    icon: 'fa-vial',
                    description: 'Тесты на беременность, COVID-19, стрептококк и др.'
                }
            ];
            
            localStorage.setItem('categories', JSON.stringify(currentCategories));
        }

        function renderCategoriesList() {
            const container = document.getElementById('categoriesContainer');
            
            if (currentCategories.length === 0) {
                container.innerHTML = `
                    <div class="empty-categories">
                        <i class="fas fa-folder-open"></i>
                        <p>Категорий пока нет. Добавьте первую категорию.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            currentCategories.forEach(category => {
                html += `
                    <div class="category-item" data-category-id="${category.id}">
                        <div class="category-icon-preview">
                            <i class="fas ${category.icon}"></i>
                        </div>
                        <div class="category-info">
                            <div class="category-name">${category.name}</div>
                            <div class="category-id">ID: ${category.id}</div>
                            ${category.description ? `<div style="font-size: 0.9rem; color: var(--text-gray); margin-top: 5px;">${category.description}</div>` : ''}
                        </div>
                        <div class="category-controls">
                            <button class="btn-small btn-edit" onclick="editCategory('${category.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-small btn-danger" onclick="deleteCategory('${category.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateCategorySelect() {
            const select = document.getElementById('productCategory');
            select.innerHTML = '<option value="">-- Выберите категорию --</option>';
            
            currentCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                select.appendChild(option);
            });
        }

        document.getElementById('categoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('categorySlug').value.toLowerCase().replace(/[^a-z0-9-]/g, '');
            const name = document.getElementById('categoryName').value.trim();
            const icon = document.getElementById('selectedIcon').value;
            const description = document.getElementById('categoryDescription').value.trim();
            
            if (!id || !name || !icon) {
                showMessage('Заполните все обязательные поля', 'error');
                return;
            }
            
            // Проверяем уникальность ID
            if (!editingCategoryId && currentCategories.find(cat => cat.id === id)) {
                showMessage('Категория с таким ID уже существует', 'error');
                return;
            }
            
            const category = {
                id: id,
                name: name,
                icon: icon,
                description: description
            };
            
            if (editingCategoryId) {
                // Обновляем существующую категорию
                const index = currentCategories.findIndex(cat => cat.id === editingCategoryId);
                if (index !== -1) {
                    // Обновляем товары, которые использовали старый ID
                    updateProductsCategoryId(editingCategoryId, id);
                    currentCategories[index] = category;
                }
            } else {
                // Добавляем новую категорию
                currentCategories.push(category);
            }
            
            localStorage.setItem('categories', JSON.stringify(currentCategories));
            
            const message = editingCategoryId ? 'Категория обновлена!' : 'Категория добавлена!';
            showMessage(message, 'success');
            
            // Обновляем интерфейс
            renderCategoriesList();
            updateCategorySelect();
            clearCategoryForm();
            
            // Обновляем статистику
            updateStats();
            
            // Обновляем каталог если открыт
            if (window.opener) {
                window.opener.location.reload();
            }
        });

        function editCategory(categoryId) {
            const category = currentCategories.find(cat => cat.id === categoryId);
            
            if (!category) {
                showMessage('Категория не найдена', 'error');
                return;
            }
            
            editingCategoryId = categoryId;
            
            // Заполняем форму
            document.getElementById('categoryId').value = categoryId;
            document.getElementById('categoryName').value = category.name;
            document.getElementById('categorySlug').value = category.id;
            document.getElementById('categoryDescription').value = category.description || '';
            
            // Выбираем иконку
            selectIcon(category.icon);
            
            // Обновляем заголовок формы
            document.getElementById('categoryFormTitle').textContent = 'Редактировать категорию';
            document.getElementById('categorySubmitBtn').innerHTML = '<i class="fas fa-save"></i> Сохранить изменения';
            
            // Переключаемся на вкладку категорий
            switchTab('categories');
            
            // Прокручиваем к форме
            document.getElementById('categoryForm').scrollIntoView({ behavior: 'smooth' });
            
            showMessage(`Режим редактирования категории "${category.name}"`, 'success');
        }

        function deleteCategory(categoryId) {
            // Проверяем, есть ли товары в этой категории
            const productsInCategory = currentProducts.filter(p => p.category === categoryId);
            
            if (productsInCategory.length > 0) {
                if (!confirm(`В категории "${categoryId}" есть ${productsInCategory.length} товаров. Удалить категорию вместе с товарами?`)) {
                    return;
                }
                
                // Удаляем товары этой категории
                currentProducts = currentProducts.filter(p => p.category !== categoryId);
                localStorage.setItem('products', JSON.stringify(currentProducts));
            } else {
                if (!confirm(`Удалить категорию "${categoryId}"?`)) {
                    return;
                }
            }
            
            // Удаляем категорию
            currentCategories = currentCategories.filter(cat => cat.id !== categoryId);
            localStorage.setItem('categories', JSON.stringify(currentCategories));
            
            // Если удаляем редактируемую категорию - очищаем форму
            if (editingCategoryId === categoryId) {
                clearCategoryForm();
            }
            
            // Обновляем интерфейс
            renderCategoriesList();
            updateCategorySelect();
            loadProducts(); // Перезагружаем товары
            
            showMessage('Категория удалена', 'success');
            
            // Обновляем каталог если открыт
            if (window.opener) {
                window.opener.location.reload();
            }
        }

        function updateProductsCategoryId(oldId, newId) {
            currentProducts.forEach(product => {
                if (product.category === oldId) {
                    product.category = newId;
                }
            });
            localStorage.setItem('products', JSON.stringify(currentProducts));
        }

        function clearCategoryForm() {
            editingCategoryId = null;
            document.getElementById('categoryForm').reset();
            document.getElementById('categoryFormTitle').textContent = 'Добавить новую категорию';
            document.getElementById('categorySubmitBtn').innerHTML = '<i class="fas fa-plus"></i> Добавить категорию';
            
            // Выбираем первую иконку
            const firstIcon = document.querySelector('.icon-option i');
            if (firstIcon) {
                selectIcon(firstIcon.classList[1]);
            }
        }

        // ===== ЗАГРУЗКА ТОВАРОВ =====
        function loadProducts() {
            try {
                currentProducts = JSON.parse(localStorage.getItem('products')) || [];
                renderProductsTable();
                updateStats();
            } catch (error) {
                console.error('Ошибка загрузки товаров:', error);
                showMessage('Ошибка загрузки товаров из базы', 'error');
            }
        }

        function renderProductsTable() {
            const container = document.getElementById('productsTable');
            
            if (currentProducts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <i class="fas fa-box-open fa-2x" style="margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Товаров пока нет</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Название</th>
                            <th>Категория</th>
                            <th>Цена</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            currentProducts.forEach(product => {
                const category = currentCategories.find(cat => cat.id === product.category);
                const categoryName = category ? category.name : product.category;
                const price = product.card.price || product.card.retail_price || '—';
                
                html += `
                    <tr>
                        <td><strong>${product.id}</strong></td>
                        <td>${product.card.title}</td>
                        <td>${categoryName}</td>
                        <td><strong>${price}</strong></td>
                        <td class="product-actions">
                            <button class="btn-small" onclick="editProduct(${product.id})">
                                <i class="fas fa-edit"></i> Ред.
                            </button>
                            <button class="btn-small btn-danger" onclick="deleteProduct(${product.id})">
                                <i class="fas fa-trash"></i> Уд.
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // ===== РЕДАКТИРОВАНИЕ ТОВАРА =====
        function editProduct(id) {
            const product = currentProducts.find(p => p.id == id);
            
            if (!product) {
                showMessage('Товар не найден', 'error');
                return;
            }
            
            editingProductId = id;
            
            // Обновляем заголовок формы
            document.getElementById('formTitle').innerHTML = `
                <i class="fas fa-edit"></i> Редактировать товар #${id}
            `;
            
            // Основные поля
            document.getElementById('productCategory').value = product.category || '';
            document.getElementById('cardTitle').value = product.card.title || '';
            document.getElementById('cardImage').value = product.card.image || '';
            document.getElementById('cardDesc').value = product.card.short_desc || '';
            document.getElementById('price').value = product.card.price || product.card.retail_price || '';
            
            // Детальная информация
            if (product.page) {
                document.getElementById('pageTitle').value = product.page.full_title || '';
                document.getElementById('pageDesc').value = product.page.description || '';
                document.getElementById('pageGallery').value = product.page.gallery?.join('\n') || '';
                document.getElementById('pageVideo').value = product.page.video || '';
                
                // Характеристики
                const specsContainer = document.getElementById('specsContainer');
                specsContainer.innerHTML = '';
                
                if (product.page.specs && product.page.specs.length > 0) {
                    product.page.specs.forEach(spec => {
                        addSpecField();
                        const items = specsContainer.querySelectorAll('.list-item');
                        const lastItem = items[items.length - 1];
                        lastItem.querySelector('.spec-name').value = spec.name || '';
                        lastItem.querySelector('.spec-value').value = spec.value || '';
                    });
                } else {
                    addSpecField();
                }
                
                // Преимущества
                const featuresContainer = document.getElementById('featuresContainer');
                featuresContainer.innerHTML = '';
                
                if (product.page.features && product.page.features.length > 0) {
                    product.page.features.forEach((feature, index) => {
                        if (index === 0) {
                            addFeatureField();
                            featuresContainer.querySelector('.feature-input').value = feature;
                        } else {
                            addFeatureField();
                            const inputs = featuresContainer.querySelectorAll('.feature-input');
                            inputs[inputs.length - 1].value = feature;
                        }
                    });
                } else {
                    addFeatureField();
                }
            }
            
            // Переключаемся на вкладку товаров
            switchTab('products');
            
            // Прокручиваем к форме
            document.getElementById('productForm').scrollIntoView({ behavior: 'smooth' });
            showMessage(`Режим редактирования товара #${id}`, 'success');
        }

        // ===== УДАЛЕНИЕ ТОВАРА =====
        function deleteProduct(id) {
            if (!confirm(`Удалить товар #${id}?`)) return;
            
            currentProducts = currentProducts.filter(p => p.id != id);
            localStorage.setItem('products', JSON.stringify(currentProducts));
            
            if (editingProductId == id) {
                clearForm();
            }
            
            loadProducts();
            showMessage('Товар удален', 'success');
            
            if (window.opener) {
                window.opener.location.reload();
            }
        }

        // ===== СОХРАНЕНИЕ ТОВАРА =====
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Собираем характеристики
            const specs = [];
            document.querySelectorAll('.list-item').forEach(item => {
                const name = item.querySelector('.spec-name')?.value;
                const value = item.querySelector('.spec-value')?.value;
                if (name && value) {
                    specs.push({ name: name.trim(), value: value.trim() });
                }
            });
            
            // Собираем преимущества
            const features = [];
            document.querySelectorAll('.feature-input').forEach(input => {
                if (input.value.trim()) {
                    features.push(input.value.trim());
                }
            });
            
            // Собираем галерею
            const gallery = document.getElementById('pageGallery').value
                .split('\n')
                .filter(url => url.trim() !== '')
                .map(url => url.trim());
            
            // Создаем объект товара
            const product = {
                id: editingProductId || Date.now(),
                category: document.getElementById('productCategory').value,
                card: {
                    title: document.getElementById('cardTitle').value.trim(),
                    price: document.getElementById('price').value.trim(),
                    image: document.getElementById('cardImage').value.trim(),
                    short_desc: document.getElementById('cardDesc').value.trim()
                },
                page: {
                    full_title: document.getElementById('pageTitle').value.trim() || document.getElementById('cardTitle').value.trim(),
                    gallery: gallery,
                    description: document.getElementById('pageDesc').value.trim(),
                    specs: specs,
                    features: features,
                    video: document.getElementById('pageVideo').value.trim()
                }
            };
            
            // Проверяем обязательные поля
            if (!product.category || !product.card.title || !product.card.price || !product.card.image || !product.card.short_desc) {
                showMessage('Заполните все обязательные поля (отмечены *)', 'error');
                return;
            }
            
            // Сохраняем
            if (editingProductId) {
                const index = currentProducts.findIndex(p => p.id == editingProductId);
                if (index !== -1) {
                    currentProducts[index] = product;
                }
            } else {
                currentProducts.push(product);
            }
            
            localStorage.setItem('products', JSON.stringify(currentProducts));
            
            const message = editingProductId ? 'Товар обновлен!' : 'Товар добавлен!';
            showMessage(message, 'success');
            
            clearForm();
            loadProducts();
            
            if (window.opener) {
                window.opener.location.reload();
            }
        });

        // ===== ИМПОРТ/ЭКСПОРТ =====
        function updateExportJson() {
            const data = {
                products: currentProducts,
                categories: currentCategories
            };
            document.getElementById('exportJson').value = JSON.stringify(data, null, 2);
        }

        function importProductsFromJson() {
            const jsonInput = document.getElementById('importJson').value.trim();
            
            if (!jsonInput) {
                showMessage('Введите JSON данные', 'error');
                return;
            }
            
            try {
                const data = JSON.parse(jsonInput);
                
                // Проверяем структуру данных
                if (Array.isArray(data)) {
                    // Это массив товаров
                    if (confirm(`Импортировать ${data.length} товаров? Существующие товары будут заменены.`)) {
                        currentProducts = data;
                        localStorage.setItem('products', JSON.stringify(currentProducts));
                        loadProducts();
                        showMessage(`${data.length} товаров успешно импортированы!`, 'success');
                        clearImportForm();
                    }
                } else if (data.products && data.categories) {
                    // Это полная структура с товарами и категориями
                    if (confirm(`Импортировать ${data.products.length} товаров и ${data.categories.length} категорий? Существующие данные будут заменены.`)) {
                        currentProducts = data.products;
                        currentCategories = data.categories;
                        localStorage.setItem('products', JSON.stringify(currentProducts));
                        localStorage.setItem('categories', JSON.stringify(currentCategories));
                        loadCategories();
                        loadProducts();
                        showMessage(`Данные успешно импортированы!`, 'success');
                        clearImportForm();
                    }
                } else {
                    showMessage('Неправильный формат JSON данных', 'error');
                }
            } catch (error) {
                showMessage('Ошибка в JSON формате: ' + error.message, 'error');
            }
        }

        function copyExportJson() {
            const textarea = document.getElementById('exportJson');
            textarea.select();
            document.execCommand('copy');
            showMessage('JSON скопирован в буфер обмена', 'success');
        }

        function clearImportForm() {
            document.getElementById('importJson').value = '';
        }

        // ===== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ =====
        function clearForm() {
            editingProductId = null;
            document.getElementById('productForm').reset();
            document.getElementById('formTitle').innerHTML = `
                <i class="fas fa-plus"></i> Добавить новый товар
            `;
            document.getElementById('price').value = '199 BYN';
            document.getElementById('specsContainer').innerHTML = `
                <div class="list-item">
                    <input type="text" class="spec-name form-input" placeholder="Название характеристики">
                    <input type="text" class="spec-value form-input" placeholder="Значение">
                    <button type="button" class="btn-small btn-danger" onclick="removeSpec(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            document.getElementById('featuresContainer').innerHTML = `
                <div class="feature-item">
                    <input type="text" class="feature-input form-input" placeholder="Например: Большой дисплей">
                    <button type="button" class="btn-small btn-danger" onclick="removeFeature(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            document.getElementById('productCategory').focus();
        }

        function saveDraft() {
            showMessage('Черновик сохранен в LocalStorage (временное хранилище браузера)', 'success');
        }

        function updateStats() {
            document.getElementById('totalProducts').textContent = currentProducts.length;
            document.getElementById('totalCategories').textContent = currentCategories.length;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ru-RU');
        }

        function showMessage(text, type) {
            const box = document.getElementById('messageBox');
            box.textContent = text;
            box.className = `message message-${type}`;
            
            setTimeout(() => {
                box.style.opacity = '0';
                setTimeout(() => {
                    box.style.display = 'none';
                    box.style.opacity = '1';
                }, 300);
            }, 3000);
        }

        function importDemoProducts() {
            if (!confirm('Добавить 2 демо-товара для тестирования?')) return;
            
            const demoProducts = [
                {
                    id: Date.now() + 1,
                    category: 'tonometers',
                    card: {
                        title: 'Тонометр автоматический Premium',
                        price: '199 BYN',
                        image: 'https://placehold.co/400x300/e2e8f0/475569?text=Тонометр+Premium',
                        short_desc: 'Автоматический тонометр с функцией измерения аритмии'
                    },
                    page: {
                        full_title: 'Тонометр автоматический Premium Pro',
                        gallery: [],
                        description: 'Профессиональный автоматический тонометр с расширенным функционалом.',
                        specs: [
                            {name: 'Тип', value: 'Автоматический'},
                            {name: 'Манжета', value: '22-42 см'}
                        ],
                        features: [
                            'Интеллектуальное измерение',
                            'Память на 90 измерений'
                        ],
                        video: ''
                    }
                },
                {
                    id: Date.now() + 2,
                    category: 'diabetes',
                    card: {
                        title: 'Глюкометр Smart Check',
                        price: '89 BYN',
                        image: 'https://placehold.co/400x300/e2e8f0/475569?text=Глюкометр+Smart',
                        short_desc: 'Точный глюкометр с Bluetooth'
                    },
                    page: {
                        full_title: 'Глюкометр Smart Check',
                        description: 'Современный глюкометр с Bluetooth.',
                        specs: [
                            {name: 'Тип', value: 'Электрохимический'},
                            {name: 'Время анализа', value: '5 секунд'}
                        ],
                        features: [
                            'Bluetooth синхронизация',
                            'Большой дисплей'
                        ]
                    }
                }
            ];
            
            demoProducts.forEach(product => {
                if (!currentProducts.find(p => p.id === product.id)) {
                    currentProducts.push(product);
                }
            });
            
            localStorage.setItem('products', JSON.stringify(currentProducts));
            loadProducts();
            showMessage('Демо-товары добавлены!', 'success');
        }

        function exportProducts() {
            const dataStr = JSON.stringify(currentProducts, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `products_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showMessage('Товары экспортированы в JSON файл', 'success');
        }
    </script>
</body>
</html>
