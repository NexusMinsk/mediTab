<script>
// Функция для правильного отображения цен в каталоге
function updateCatalogPrices() {
    const products = JSON.parse(localStorage.getItem('products')) || [];
    
    products.forEach(product => {
        // Находим карточку товара по ID
        const card = document.querySelector(`.product-card[data-admin-id="${product.id}"]`);
        if (!card) return;
        
        // Обновляем розничную цену
        const retailPriceEl = card.querySelector('.price-retail');
        if (retailPriceEl && product.card.retail_price) {
            retailPriceEl.textContent = product.card.retail_price;
        }
        
        // Обновляем оптовую цену
        const wholesalePriceEl = card.querySelector('.price-wholesale');
        if (wholesalePriceEl) {
            if (product.card.wholesale_price) {
                wholesalePriceEl.textContent = product.card.wholesale_price;
                // Добавляем метку "Есть опт"
                if (!card.querySelector('.wholesale-badge')) {
                    const badge = document.createElement('div');
                    badge.className = 'wholesale-badge';
                    badge.style.cssText = 'font-size: 0.8rem; color: #10b981; margin-top: 5px;';
                    badge.innerHTML = '<i class="fas fa-check"></i> Есть оптовая цена';
                    card.querySelector('.product-info').appendChild(badge);
                }
            } else {
                wholesalePriceEl.textContent = 'По запросу';
                // Удаляем метку если была
                const badge = card.querySelector('.wholesale-badge');
                if (badge) badge.remove();
            }
        }
    });
}

// Вызываем при загрузке и при изменении LocalStorage
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(updateCatalogPrices, 1000);
    
    window.addEventListener('storage', function(e) {
        if (e.key === 'products') {
            setTimeout(updateCatalogPrices, 500);
        }
    });
});
</script>
